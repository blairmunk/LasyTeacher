You are an expert software architect. The user is providing you with the complete source code for a project, contained in a single file. Your task is to meticulously analyze the provided codebase to gain a comprehensive understanding of its structure, functionality, dependencies, and overall architecture.

A file tree is provided below to give you a high-level overview. The subsequent sections contain the full content of each file, clearly marked with "// FILE: <path>".

Your instructions are:
1.  **Analyze Thoroughly:** Read through every file to understand its purpose and how it interacts with other files.
2.  **Identify Key Components:** Pay close attention to configuration files (like package.json, pyproject.toml), entry points (like index.js, main.py), and core logic.

## Project File Tree

```
latex_generator/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ admin.py
‚îú‚îÄ‚îÄ apps.py
‚îú‚îÄ‚îÄ generators
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îú‚îÄ‚îÄ registry.py
‚îÇ   ‚îî‚îÄ‚îÄ work_generator.py
‚îú‚îÄ‚îÄ management
‚îÇ   ‚îî‚îÄ‚îÄ commands
‚îÇ       ‚îú‚îÄ‚îÄ generate_latex.py
‚îÇ       ‚îî‚îÄ‚îÄ list_generators.py
‚îú‚îÄ‚îÄ models.py
‚îú‚îÄ‚îÄ templates
‚îÇ   ‚îú‚îÄ‚îÄ admin
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ latex_generator
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ generate.html
‚îÇ   ‚îî‚îÄ‚îÄ latex
‚îÇ       ‚îú‚îÄ‚îÄ base
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ document_base.tex
‚îÇ       ‚îî‚îÄ‚îÄ work
‚îÇ           ‚îú‚îÄ‚îÄ all_variants.tex
‚îÇ           ‚îî‚îÄ‚îÄ work_all_variants.tex
‚îú‚îÄ‚îÄ templatetags
‚îÇ   ‚îî‚îÄ‚îÄ math_tags.py
‚îú‚îÄ‚îÄ tests.py
‚îú‚îÄ‚îÄ urls.py
‚îú‚îÄ‚îÄ utils
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ compilation.py
‚îÇ   ‚îú‚îÄ‚îÄ latex_specific.py
‚îÇ   ‚îî‚îÄ‚îÄ latex_utils.py
‚îî‚îÄ‚îÄ views.py
```

---

// FILE: __init__.py
```

```

// FILE: admin.py
```
from django.contrib import admin
from django.http import HttpResponseRedirect
from django.urls import path
from django.shortcuts import render
from django.contrib import messages
from .generators.registry import registry
from works.models import Work

class LaTeXGeneratorAdmin:
    """–ê–¥–º–∏–Ω–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è LaTeX –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞–º–∏"""
    
    def __init__(self, admin_site):
        self.admin_site = admin_site
    
    def get_urls(self):
        urls = [
            path('latex-generator/', self.admin_site.admin_view(self.generate_view), name='latex_generator_generate'),
        ]
        return urls
    
    def generate_view(self, request):
        """–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""
        if request.method == 'POST':
            doc_type = request.POST.get('type')
            object_id = request.POST.get('object_id')
            output_format = request.POST.get('format', 'pdf')
            with_answers = request.POST.get('with_answers') == 'on'
            
            try:
                generator_class = registry.get_generator(doc_type)
                
                if doc_type == 'work':
                    work = Work.objects.get(pk=object_id)
                    generator = generator_class(output_dir='latex_output')
                    
                    if with_answers:
                        files = generator.generate_with_answers(work, output_format)
                    else:
                        files = generator.generate(work, output_format)
                    
                    messages.success(request, f'–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: {", ".join(files)}')
                
            except Exception as e:
                messages.error(request, f'–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {e}')
            
            return HttpResponseRedirect(request.path)
        
        # GET –∑–∞–ø—Ä–æ—Å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
        context = {
            'title': '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤',
            'available_generators': registry.get_available_types(),
            'works': Work.objects.all()[:10],  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 10 —Ä–∞–±–æ—Ç
        }
        
        return render(request, 'admin/latex_generator/generate.html', context)

# –í–†–ï–ú–ï–ù–ù–û –£–ë–ò–†–ê–ï–ú –†–ï–ì–ò–°–¢–†–ê–¶–ò–Æ –ê–î–ú–ò–ù–ö–ò
# admin.site.register(LaTeXGeneratorProxy, LaTeXGeneratorAdmin)

```

// FILE: apps.py
```
from django.apps import AppConfig

class LatexGeneratorConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'latex_generator'
    verbose_name = 'LaTeX Generator'
    
    def ready(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        pass

```

// FILE: generators/__init__.py
```
"""–≠–∫—Å–ø–æ—Ä—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤"""

from .base import BaseLatexGenerator
from .work_generator import WorkLatexGenerator
from .registry import registry

__all__ = [
    'BaseLatexGenerator',
    'WorkLatexGenerator',
    'registry',
]

```

// FILE: generators/base.py
```
"""–ë–∞–∑–æ–≤—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""

from abc import ABC, abstractmethod
from typing import Dict, Any, List, Optional
from pathlib import Path
from django.template.loader import render_to_string
from latex_generator.utils import sanitize_filename, compile_latex_to_pdf

class BaseLatexGenerator(ABC):
    """–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ LaTeX"""
    
    def __init__(self, output_dir: Path):
        self.output_dir = Path(output_dir)
        self.output_dir.mkdir(parents=True, exist_ok=True)
    
    @abstractmethod
    def get_template_name(self) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º—è —à–∞–±–ª–æ–Ω–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"""
        pass
    
    @abstractmethod
    def prepare_context(self, source_object: Any) -> Dict[str, Any]:
        """–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —à–∞–±–ª–æ–Ω–∞"""
        pass
    
    @abstractmethod
    def get_output_filename(self, source_object: Any) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"""
        pass
    
    def generate(self, source_object: Any, output_format: str = 'pdf') -> List[str]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç LaTeX –¥–æ–∫—É–º–µ–Ω—Ç
        
        Args:
            source_object: –û–±—ä–µ–∫—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (Work, Report, etc.)
            output_format: 'latex' –∏–ª–∏ 'pdf'
            
        Returns:
            –°–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –∫ —Å–æ–∑–¥–∞–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º
        """
        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        context = self.prepare_context(source_object)
        
        # –†–µ–Ω–¥–µ—Ä–∏–º —à–∞–±–ª–æ–Ω
        template_name = self.get_template_name()
        latex_content = render_to_string(template_name, context)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º LaTeX —Ñ–∞–π–ª
        filename = self.get_output_filename(source_object)
        latex_filename = sanitize_filename(filename)
        latex_file = self.output_dir / latex_filename
        
        with open(latex_file, 'w', encoding='utf-8') as f:
            f.write(latex_content)
        
        files = [str(latex_file)]
        
        # –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –≤ PDF –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if output_format == 'pdf':
            pdf_file = compile_latex_to_pdf(latex_file, self.output_dir)
            if pdf_file:
                files.append(str(pdf_file))
        
        return files

```

// FILE: generators/registry.py
```
"""–†–µ–µ—Å—Ç—Ä –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ LaTeX"""

from typing import Dict, Type
from .base import BaseLatexGenerator
from .work_generator import WorkLatexGenerator

class GeneratorRegistry:
    """–†–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤"""
    
    _generators: Dict[str, Type[BaseLatexGenerator]] = {
        'work': WorkLatexGenerator,
        # –í –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–∏–º:
        # 'report': ReportLatexGenerator,
        # 'certificate': CertificateLatexGenerator,
    }
    
    @classmethod
    def get_generator(cls, generator_type: str) -> Type[BaseLatexGenerator]:
        """–ü–æ–ª—É—á–∏—Ç—å –∫–ª–∞—Å—Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ —Ç–∏–ø—É"""
        if generator_type not in cls._generators:
            available = ', '.join(cls._generators.keys())
            raise ValueError(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞: {generator_type}. –î–æ—Å—Ç—É–ø–Ω—ã–µ: {available}")
        
        return cls._generators[generator_type]
    
    @classmethod
    def get_available_types(cls) -> list:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤"""
        return list(cls._generators.keys())
    
    @classmethod
    def register_generator(cls, generator_type: str, generator_class: Type[BaseLatexGenerator]):
        """–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä"""
        cls._generators[generator_type] = generator_class

# –≠–∫–∑–µ–º–ø–ª—è—Ä –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
registry = GeneratorRegistry()

```

// FILE: generators/work_generator.py
```
"""–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä LaTeX –¥–ª—è —Ä–∞–±–æ—Ç —Å –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""

from typing import Dict, Any
from pathlib import Path

from document_generator.utils.formula_utils import formula_processor
from document_generator.utils.image_utils import prepare_images 
from document_generator.utils.file_utils import sanitize_filename
from latex_generator.utils import sanitize_latex, render_task_with_images
from latex_generator.utils.latex_specific import latex_formula_processor
from latex_generator.utils.compilation import latex_compiler, LaTeXCompilationError

from .base import BaseLatexGenerator
import logging

logger = logging.getLogger(__name__)

class WorkLatexGenerator(BaseLatexGenerator):
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç —Å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏"""
    
    def get_template_name(self) -> str:
        return 'latex/work/all_variants.tex'
    
    def get_output_filename(self, work) -> str:
        return f"{work.name}_all_variants.tex"
    
    def prepare_context(self, work) -> Dict[str, Any]:
        """–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–æ—Ä–º—É–ª"""
        
        variants = work.variant_set.all().order_by('number')
        
        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
        all_variants_data = []
        document_errors = []
        document_warnings = []
        
        for variant in variants:
            variant_data = self._prepare_variant_context(variant)
            all_variants_data.append(variant_data)
            
            # –°–æ–±–∏—Ä–∞–µ–º –æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            document_errors.extend(variant_data.get('errors', []))
            document_warnings.extend(variant_data.get('warnings', []))
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
        work_name_processed = latex_formula_processor.render_for_latex_safe(work.name)
        document_errors.extend(work_name_processed['errors'])
        document_warnings.extend(work_name_processed['warnings'])
        
        return {
            'work': work,
            'work_name': work_name_processed['content'],
            'variants': all_variants_data,
            'total_variants': len(all_variants_data),
            'with_answers': getattr(self, '_with_answers', False),
            
            # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Ñ–æ—Ä–º—É–ª
            'has_formula_errors': len(document_errors) > 0,
            'has_formula_warnings': len(document_warnings) > 0,
            'formula_errors': document_errors,
            'formula_warnings': document_warnings,
        }
    
    def _prepare_variant_context(self, variant):
        """–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–æ—Ä–º—É–ª"""
        tasks = variant.tasks.all().order_by('id')
        
        prepared_tasks = []
        variant_errors = []
        variant_warnings = []
        
        for i, task in enumerate(tasks, 1):
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è
            text_processed = latex_formula_processor.render_for_latex_safe(task.text)
            answer_processed = latex_formula_processor.render_for_latex_safe(task.answer or '')  # –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–æ–±–∞–≤–ª–µ–Ω–æ or ''
            
            # –°–æ–±–∏—Ä–∞–µ–º –æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            task_errors = []
            task_warnings = []
            
            task_errors.extend(text_processed['errors'])
            task_errors.extend(answer_processed['errors'])
            task_warnings.extend(text_processed['warnings'])
            task_warnings.extend(answer_processed['warnings'])
            
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –µ—Å–ª–∏ –µ—Å—Ç—å
            short_solution_processed = {'content': '', 'errors': [], 'warnings': []}
            full_solution_processed = {'content': '', 'errors': [], 'warnings': []}
            hint_processed = {'content': '', 'errors': [], 'warnings': []}
            instruction_processed = {'content': '', 'errors': [], 'warnings': []}  # –î–û–ë–ê–í–õ–ï–ù–û
            
            if task.short_solution:
                short_solution_processed = latex_formula_processor.render_for_latex_safe(task.short_solution)
                task_errors.extend(short_solution_processed['errors'])
                task_warnings.extend(short_solution_processed['warnings'])
            
            if task.full_solution:
                full_solution_processed = latex_formula_processor.render_for_latex_safe(task.full_solution)
                task_errors.extend(full_solution_processed['errors'])
                task_warnings.extend(full_solution_processed['warnings'])
            
            if task.hint:
                hint_processed = latex_formula_processor.render_for_latex_safe(task.hint)
                task_errors.extend(hint_processed['errors'])
                task_warnings.extend(hint_processed['warnings'])
            
            # –î–û–ë–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç–∫–∞ instruction
            if hasattr(task, 'instruction') and task.instruction:
                instruction_processed = latex_formula_processor.render_for_latex_safe(task.instruction)
                task_errors.extend(instruction_processed['errors'])
                task_warnings.extend(instruction_processed['warnings'])
            
            # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            task_images = []
            for image in task.images.all().order_by('order'):
                image_data = prepare_images(image, self.output_dir)
                if image_data:
                    task_images.append(image_data)
            
            # –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏
            task_data = {
                'number': i,
                'task': task,
                'text': text_processed['content'],  # –£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è LaTeX
                'answer': answer_processed['content'],
                'short_solution': short_solution_processed['content'],
                'full_solution': full_solution_processed['content'],
                'hint': hint_processed['content'],
                'instruction': instruction_processed['content'],  # –î–û–ë–ê–í–õ–ï–ù–û
                'images': task_images,
                
                # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Ñ–æ—Ä–º—É–ª
                'has_formula_errors': len(task_errors) > 0,
                'has_formula_warnings': len(task_warnings) > 0,
                'formula_errors': task_errors,
                'formula_warnings': task_warnings,
            }
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π LaTeX –∫–æ–¥ —Å —É—á–µ—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            if task_images:
                # –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É minipage
                task_data['latex_content'] = render_task_with_images(
                    {'text': task_data['text']}, 
                    task_images
                )
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                task_data['latex_content'] = task_data['text']
            
            prepared_tasks.append(task_data)
            variant_errors.extend(task_errors)
            variant_warnings.extend(task_warnings)
        
        return {
            'variant': variant,
            'tasks': prepared_tasks,
            'total_tasks': len(prepared_tasks),
            'errors': variant_errors,
            'warnings': variant_warnings,
        }
    
    def generate(self, work, output_format='pdf'):
        """–ò–°–ü–†–ê–í–õ–ï–ù–û: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤"""
        try:
            # –í—ã–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é LaTeX —Ñ–∞–π–ª–∞
            files = super().generate(work, output_format)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ —Ñ–æ—Ä–º—É–ª –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
            context = self.prepare_context(work)
            
            if context.get('has_formula_errors'):
                logger.warning(f"–†–∞–±–æ—Ç–∞ {work.name} —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö: {context['formula_errors']}")
            
            if context.get('has_formula_warnings'):
                logger.info(f"–†–∞–±–æ—Ç–∞ {work.name} —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö: {context['formula_warnings']}")
            
            # –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏–ª–∏ PDF, –ø—ã—Ç–∞–µ–º—Å—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å
            if output_format == 'pdf' and files:
                latex_file_path = Path(files[0])  
                
                compilation_result = latex_compiler.compile_latex_safe(
                    latex_file_path, 
                    self.output_dir
                )
                
                if compilation_result['success']:
                    # –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ PDF –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
                    pdf_path = compilation_result['pdf_path']
                    if pdf_path not in files:
                        files.append(pdf_path)
                    
                    if compilation_result.get('has_warnings'):
                        logger.info(f"LaTeX –∫–æ–º–ø–∏–ª—è—Ü–∏—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ –¥–ª—è {work.name}")
                    
                else:
                    # –ù–µ—É–¥–∞—á–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è - –ª–æ–≥–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª–∏
                    error_msg = compilation_result.get('message', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')
                    logger.error(f"LaTeX –∫–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–µ—É–¥–∞—á–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã {work.name}: {error_msg}")
                    
                    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ
                    error_report = self._generate_error_report(work, compilation_result)
                    
                    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–∞—Ö
                    error_file = self.output_dir / f"{work.name}_latex_errors.txt"
                    error_file.write_text(error_report, encoding='utf-8')
                    
                    # –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª –æ—Ç—á–µ—Ç–∞ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
                    error_file_str = str(error_file)
                    if error_file_str not in files:
                        files.append(error_file_str)
                    
                    # –ù–û–í–û–ï: –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
                    raise LaTeXCompilationError(
                        error_msg, 
                        error_details=compilation_result,
                        latex_log=compilation_result.get('latex_log')
                    )
            
            return files
            
        except LaTeXCompilationError:
            # –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º LaTeX –æ—à–∏–±–∫–∏ –∫–∞–∫ –µ—Å—Ç—å
            raise
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ LaTeX –¥–ª—è —Ä–∞–±–æ—Ç—ã {work.name}: {e}")
            raise

    
    def _generate_error_report(self, work, compilation_result: Dict) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–∞—Ö –∫–æ–º–ø–∏–ª—è—Ü–∏–∏"""
        report_lines = [
            f"–û–¢–ß–ï–¢ –û–ë –û–®–ò–ë–ö–ê–• LATEX –ö–û–ú–ü–ò–õ–Ø–¶–ò–ò",
            f"======================================",
            f"",
            f"–†–∞–±–æ—Ç–∞: {work.name}",
            f"–î–∞—Ç–∞: {getattr(work, 'created_at', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}",
            f"–¢–∏–ø –æ—à–∏–±–∫–∏: {compilation_result.get('error_type', 'unknown')}",
            f"",
            f"–û–°–ù–û–í–ù–ê–Ø –û–®–ò–ë–ö–ê:",
            f"{compilation_result.get('message', '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ')}",
            f"",
        ]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫
        errors = compilation_result.get('errors', [])
        if errors:
            report_lines.extend([
                "–î–ï–¢–ê–õ–ò –û–®–ò–ë–û–ö:",
                "==============="
            ])
            
            for i, error in enumerate(errors, 1):
                report_lines.extend([
                    f"{i}. {error.get('message', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}",
                    f"   –°—Ç—Ä–æ–∫–∞: {error.get('line_number', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}",
                ])
                
                # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –µ—Å—Ç—å
                context = error.get('context', [])
                if context:
                    report_lines.extend([
                        "   –ö–æ–Ω—Ç–µ–∫—Å—Ç:"
                    ] + [f"   {line}" for line in context])
                
                report_lines.append("")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        suggestions = compilation_result.get('suggestions', [])
        if suggestions:
            report_lines.extend([
                "–ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ:",
                "============================"
            ])
            
            for i, suggestion in enumerate(suggestions, 1):
                report_lines.append(f"{i}. {suggestion}")
            
            report_lines.append("")
        
        # –î–æ–±–∞–≤–ª—è–µ–º —á–∞—Å—Ç—å –ª–æ–≥–∞ LaTeX (–µ—Å–ª–∏ –µ—Å—Ç—å)
        latex_log = compilation_result.get('latex_log')
        if latex_log:
            report_lines.extend([
                "–§–†–ê–ì–ú–ï–ù–¢ –õ–û–ì–ê LATEX:",
                "====================",
                latex_log[:2000],  # –ü–µ—Ä–≤—ã–µ 2000 —Å–∏–º–≤–æ–ª–æ–≤
                "",
                "...(–ø–æ–ª–Ω—ã–π –ª–æ–≥ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)..."
            ])
        
        return "\n".join(report_lines)
    
    def generate_with_answers(self, work, output_format='pdf'):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å –æ—Ç–≤–µ—Ç–∞–º–∏"""
        self._with_answers = True
        try:
            return self.generate(work, output_format)
        finally:
            self._with_answers = False


```

// FILE: management/commands/generate_latex.py
```
"""–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""

from pathlib import Path
from django.core.management.base import BaseCommand, CommandError
from django.apps import apps

from latex_generator.generators.registry import registry

class Command(BaseCommand):
    help = '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤'
    
    def add_arguments(self, parser):
        parser.add_argument(
            'type', 
            choices=registry.get_available_types(),
            help='–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'
        )
        parser.add_argument('object_id', type=int, help='ID –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏')
        parser.add_argument(
            '--format',
            choices=['latex', 'pdf'],
            default='pdf',
            help='–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞: latex –∏–ª–∏ pdf'
        )
        parser.add_argument(
            '--output-dir',
            default='latex_output',
            help='–ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤'
        )
        parser.add_argument(
            '--with-answers',
            action='store_true',
            help='–í–∫–ª—é—á–∏—Ç—å –æ—Ç–≤–µ—Ç—ã (–¥–ª—è —Ä–∞–±–æ—Ç)'
        )
    
    def handle(self, *args, **options):
        doc_type = options['type']
        object_id = options['object_id']
        output_format = options['format']
        output_dir = Path(options['output_dir'])
        with_answers = options['with_answers']
        
        # –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞—Å—Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
        generator_class = registry.get_generator(doc_type)
        
        # –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        try:
            model_class = self._get_model_class(doc_type)
            obj = model_class.objects.get(pk=object_id)
        except model_class.DoesNotExist:
            raise CommandError(f'{doc_type.title()} —Å ID {object_id} –Ω–µ –Ω–∞–π–¥–µ–Ω')
        
        # –°–æ–∑–¥–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
        generator = generator_class(output_dir)
        
        # –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        self.stdout.write(f'üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è {doc_type} –¥–ª—è: {obj}')
        if doc_type == 'work':
            # –ò–°–ü–†–ê–í–õ–ï–ù–û: variants -> variant_set
            variants_count = obj.variant_set.count()
            if variants_count == 0:
                raise CommandError('–£ —Ä–∞–±–æ—Ç—ã –Ω–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. –°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.')
            self.stdout.write(f'üìã –ù–∞–π–¥–µ–Ω–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: {variants_count}')
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
        try:
            if doc_type == 'work' and with_answers:
                files = generator.generate_with_answers(obj, output_format)
            else:
                files = generator.generate(obj, output_format)
            
            self.stdout.write(
                self.style.SUCCESS(f'üéâ –ì–æ—Ç–æ–≤–æ! –°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: {len(files)}')
            )
            
            for file_path in files:
                self.stdout.write(f'  üìÑ {file_path}')
                
        except Exception as e:
            raise CommandError(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {e}')
    
    def _get_model_class(self, doc_type):
        """–ü–æ–ª—É—á–∏—Ç—å –∫–ª–∞—Å—Å –º–æ–¥–µ–ª–∏ –ø–æ —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞"""
        model_mapping = {
            'work': 'works.Work',
            # –í –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–∏–º:
            # 'report': 'reports.Report',
        }
        
        if doc_type not in model_mapping:
            raise CommandError(f'–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞: {doc_type}')
        
        app_label, model_name = model_mapping[doc_type].split('.')
        return apps.get_model(app_label, model_name)

```

// FILE: management/commands/list_generators.py
```
"""–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤"""

from django.core.management.base import BaseCommand
from latex_generator.generators.registry import registry

class Command(BaseCommand):
    help = '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ LaTeX'
    
    def handle(self, *args, **options):
        self.stdout.write('üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã LaTeX:')
        
        for generator_type in registry.get_available_types():
            generator_class = registry.get_generator(generator_type)
            self.stdout.write(f'  ‚Ä¢ {generator_type}: {generator_class.__name__}')
        
        self.stdout.write('\nüí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:')
        self.stdout.write('  python manage.py generate_latex <—Ç–∏–ø> <id> [–æ–ø—Ü–∏–∏]')
        self.stdout.write('\nüîß –ü—Ä–∏–º–µ—Ä—ã:')
        self.stdout.write('  python manage.py generate_latex work 1 --format pdf')
        self.stdout.write('  python manage.py generate_latex work 1 --with-answers')

```

// FILE: models.py
```
from django.db import models

# Create your models here.

```

// FILE: templates/admin/latex_generator/generate.html
```
{% extends "admin/base_site.html" %}
{% load i18n %}

{% block title %}–ì–µ–Ω–µ—Ä–∞—Ü–∏—è LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤{% endblock %}

{% block content_title %}
    <h1>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h1>
{% endblock %}

{% block content %}
<div class="module filtered">
    <form method="post">
        {% csrf_token %}
        
        <div class="form-row">
            <div class="field-box">
                <label for="type">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞:</label>
                <select name="type" id="type" required>
                    {% for generator_type in available_generators %}
                        <option value="{{ generator_type }}">{{ generator_type|capfirst }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="field-box">
                <label for="object_id">–û–±—ä–µ–∫—Ç:</label>
                <select name="object_id" id="object_id" required>
                    {% for work in works %}
                        <option value="{{ work.id }}">{{ work.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="field-box">
                <label for="format">–§–æ—Ä–º–∞—Ç:</label>
                <select name="format" id="format">
                    <option value="pdf">PDF</option>
                    <option value="latex">LaTeX</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="field-box">
                <label for="with_answers">
                    <input type="checkbox" name="with_answers" id="with_answers">
                    –í–∫–ª—é—á–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
                </label>
            </div>
        </div>
        
        <div class="submit-row">
            <input type="submit" value="–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" class="default">
        </div>
    </form>
</div>
{% endblock %}

```

// FILE: templates/latex/base/document_base.tex
```
{% comment %}
–ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
{% endcomment %}

\documentclass[12pt,a4paper]{article}

% –ü–∞–∫–µ—Ç—ã –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}

% –ü–∞–∫–µ—Ç—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
\usepackage[margin=2cm]{geometry}
\usepackage{amsmath, amsfonts, amssymb}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage{fancyhdr}

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
\titleformat{\section}{\large\bfseries}{\thesection.}{1em}{}
\titleformat{\subsection}{\normalsize\bfseries}{\thesubsection.}{1em}{}

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª–æ–≤
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{ {% block header_left %}{% endblock %} }
\fancyhead[R]{ {% block header_right %}\thepage{% endblock %} }
\fancyfoot[C]{ {% block footer_center %}{% endblock %} }

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç—Å—Ç—É–ø–æ–≤
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt}

\begin{document}

{% block content %}
{% endblock %}

\end{document}

```

// FILE: templates/latex/work/all_variants.tex
```
\documentclass[12pt,a4paper]{article}

% –ü–∞–∫–µ—Ç—ã –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}

% –ü–∞–∫–µ—Ç—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
\usepackage[margin=2cm]{geometry}
\usepackage{amsmath, amsfonts, amssymb}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage{fancyhdr}

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
\titleformat{\section}{\large\bfseries}{\thesection.}{1em}{}
\titleformat{\subsection}{\normalsize\bfseries}{\thesubsection.}{1em}{}

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª–æ–≤
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{ {{work_name}} }
\fancyhead[R]{\thepage}
\fancyfoot[C]{–í—Å–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: {{ total_variants }}}

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç—Å—Ç—É–ø–æ–≤
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt}

\begin{document}

% –¢–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç
\begin{center}
    {\LARGE\bfseries {{ work_name }} }\\[0.8cm]
    {% if work.duration %}
    {\large –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {{ work.duration }} –º–∏–Ω—É—Ç}\\[0.4cm]
    {% endif %}
    {\large –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: {{ total_variants }}}\\[0.3cm]
    {\normalsize \today}
\end{center}

\vspace{1cm}

% –û–±—â–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
{\small\textit{%
–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∏ –¥–∞–π—Ç–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã. \\
–ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ö–æ–¥ —Ä–µ—à–µ–Ω–∏—è. –ö–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
}}

\newpage

% –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
{% for variant_data in variants %}

% –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–∞
\begin{center}
    {\Large\bfseries –í–∞—Ä–∏–∞–Ω—Ç {{ variant_data.variant.number }} }
\end{center}

\vspace{0.8cm}

% –ó–∞–¥–∞–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞
{% for task_data in variant_data.tasks %}
\section*{–ó–∞–¥–∞–Ω–∏–µ {{ task_data.number }}}

% –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π LaTeX –∫–æ–¥ —Å minipage
{{ task_data.latex_content|safe }}

\vspace{1ex}

{% endfor %}

% –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
{% if not forloop.last %}
\newpage
{% endif %}

{% endfor %}

{% if with_answers %}
\newpage
% –õ–∏—Å—Ç –æ—Ç–≤–µ—Ç–æ–≤
\section*{\centering –û–¢–í–ï–¢–´}

{% for variant_data in variants %}
\subsection*{–í–∞—Ä–∏–∞–Ω—Ç {{ variant_data.variant.number }}}

\begin{enumerate}
{% for task_data in variant_data.tasks %}
\item {{ task_data.answer|safe }}
{% endfor %}
\end{enumerate}

{% if not forloop.last %}\vspace{0.5cm}{% endif %}

{% endfor %}
{% endif %}

\end{document}

```

// FILE: templates/latex/work/work_all_variants.tex
```
\documentclass[12pt,a4paper]{article}

% –ü–∞–∫–µ—Ç—ã –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}

% –ü–∞–∫–µ—Ç—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
\usepackage[margin=2cm]{geometry}
\usepackage{amsmath, amsfonts, amssymb}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage{fancyhdr}

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
\titleformat{\section}{\large\bfseries}{\thesection.}{1em}{}
\titleformat{\subsection}{\normalsize\bfseries}{\thesubsection.}{1em}{}

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª–æ–≤
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{ {{ work_name }} }
\fancyhead[R]{\thepage}
\fancyfoot[C]{–í—Å–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: {{ total_variants }}}

% –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç—Å—Ç—É–ø–æ–≤
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt}

\begin{document}

% –¢–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç
\begin{center}
    {\LARGE\bfseries {{ work_name }} }\\[0.8cm]
    {% if work.duration %}
    {\large –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {{ work.duration }} –º–∏–Ω—É—Ç}\\[0.4cm]
    {% endif %}
    {\large –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: {{ total_variants }}}\\[0.3cm]
    {\normalsize \today}
\end{center}

\vspace{1cm}

% –û–±—â–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
{\small\textit{%
–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∏ –¥–∞–π—Ç–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã. \\
–ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ö–æ–¥ —Ä–µ—à–µ–Ω–∏—è. –ö–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
}}

\newpage

% –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
{% for variant_data in variants %}

% –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–∞
\begin{center}
    {\Large\bfseries –í–∞—Ä–∏–∞–Ω—Ç {{ variant_data.variant.number }} }
\end{center}

\vspace{0.8cm}

% –ó–∞–¥–∞–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞
{% for task_data in variant_data.tasks %}
\section*{–ó–∞–¥–∞–Ω–∏–µ {{ task_data.number }}}

{{ task_data.text }}

{% for image in task_data.images %}
    {% if image.latex_position.placement == 'figure' %}
    \begin{figure}[h]
        \centering
        \includegraphics[width={{ image.latex_position.width }}]{ {{ image.filename }} }
        {% if image.caption %}
        \caption{ {{ image.caption }} }
        {% endif %}
    \end{figure}
    {% elif image.latex_position.placement == 'wrapfigure' %}
    \begin{wrapfigure}{ {{ image.latex_position.align }} }{ {{ image.latex_position.width }} }
        \centering
        \includegraphics[width={{ image.latex_position.width }}]{ {{ image.filename }} }
        {% if image.caption %}
        \caption{ {{ image.caption }} }
        {% endif %}
    \end{wrapfigure}
    {% endif %}
{% endfor %}

\vspace{1cm}

{% endfor %}

% –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
{% if not forloop.last %}
\newpage
{% endif %}

{% endfor %}

{% if with_answers %}
\newpage
% –õ–∏—Å—Ç –æ—Ç–≤–µ—Ç–æ–≤
\section*{\centering –û–¢–í–ï–¢–´}

{% for variant_data in variants %}
\subsection*{–í–∞—Ä–∏–∞–Ω—Ç {{ variant_data.variant.number }}}

\begin{enumerate}
{% for task_data in variant_data.tasks %}
\item {{ task_data.answer }}
{% endfor %}
\end{enumerate}

{% if not forloop.last %}\vspace{0.5cm}{% endif %}

{% endfor %}
{% endif %}

\end{document}

```

// FILE: templatetags/math_tags.py
```
"""Template tags –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""

from django import template
from django.utils.safestring import mark_safe
from django.utils.html import escape
from document_generator.utils.formula_utils import formula_processor

register = template.Library()

@register.filter
def render_math(text):
    """–§–∏–ª—å—Ç—Ä –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ"""
    if not text:
        return ''
    
    # –î–ª—è –≤–µ–±-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç –∫–∞–∫ –µ—Å—Ç—å
    # MathJax –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç $ –∏ $$ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    return mark_safe(text)

@register.filter  
def has_math(text):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ —Ñ–æ—Ä–º—É–ª—ã"""
    return formula_processor.has_math(text)

@register.filter
def math_count(text):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º—É–ª –≤ —Ç–µ–∫—Å—Ç–µ"""
    return formula_processor.count_formulas(text)

@register.filter
def math_errors(text):
    """–ù–û–í–û–ï: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö"""
    if not text:
        return []
    
    processed = formula_processor.process_text_safe(text)
    return processed.get('errors', [])

@register.filter
def math_warnings(text):
    """–ù–û–í–û–ï: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö"""
    if not text:
        return []
    
    processed = formula_processor.process_text_safe(text)
    return processed.get('warnings', [])

@register.filter
def has_math_errors(text):
    """–ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö"""
    if not text:
        return False
    
    processed = formula_processor.process_text_safe(text)
    return processed.get('has_errors', False)

@register.filter
def has_math_warnings(text):
    """–ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö"""
    if not text:
        return False
    
    processed = formula_processor.process_text_safe(text)
    return processed.get('has_warnings', False)

@register.simple_tag
def math_indicator(text):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–ª–∏—á–∏—è —Ñ–æ—Ä–º—É–ª —Å –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π –æ—à–∏–±–æ–∫"""
    if not formula_processor.has_math(text):
        return ''
    
    count = formula_processor.count_formulas(text)
    processed = formula_processor.process_text_safe(text)
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∏–ª—å –±–µ–π–¥–∂–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –æ—à–∏–±–æ–∫
    if processed.get('has_errors', False):
        badge_class = 'bg-danger'
        icon = '‚ö†Ô∏è'
        title = f"–§–æ—Ä–º—É–ª: {count}. –ï—Å—Ç—å –æ—à–∏–±–∫–∏!"
    elif processed.get('has_warnings', False):
        badge_class = 'bg-warning text-dark'
        icon = '‚ö°'
        title = f"–§–æ—Ä–º—É–ª: {count}. –ï—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è"
    else:
        badge_class = 'bg-success'
        icon = 'üìê'
        title = f"–§–æ—Ä–º—É–ª: {count}. –í—Å–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    
    return mark_safe(
        f'<span class="badge {badge_class} formula-badge" title="{title}">'
        f'{icon} {count}</span>'
    )

@register.inclusion_tag('math/formula_errors.html')
def show_formula_errors(text, show_warnings=True):
    """–ù–û–í–û–ï: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–∞—Ö —Ñ–æ—Ä–º—É–ª"""
    if not text:
        return {'errors': [], 'warnings': [], 'formulas': []}
    
    processed = formula_processor.process_text_safe(text)
    
    return {
        'errors': processed.get('errors', []),
        'warnings': processed.get('warnings', []) if show_warnings else [],
        'formulas': processed.get('formulas', []),
        'has_errors': processed.get('has_errors', False),
        'has_warnings': processed.get('has_warnings', False),
    }

@register.inclusion_tag('math/formula_preview.html')
def formula_preview(text, max_formulas=3):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é —Ñ–æ—Ä–º—É–ª –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Å –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π —Å—Ç–∞—Ç—É—Å–∞"""
    if not text:
        return {'formulas': [], 'has_issues': False}
    
    processed = formula_processor.process_text_safe(text)
    all_formulas = processed.get('formulas', [])
    
    return {
        'formulas': all_formulas[:max_formulas],
        'total_count': len(all_formulas),
        'has_more': len(all_formulas) > max_formulas,
        'has_errors': processed.get('has_errors', False),
        'has_warnings': processed.get('has_warnings', False),
    }

@register.simple_tag
def math_status_alert(text, alert_id=None):
    """–ù–û–í–û–ï: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç alert —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–µ —Ñ–æ—Ä–º—É–ª"""
    if not formula_processor.has_math(text):
        return ''
    
    processed = formula_processor.process_text_safe(text)
    
    if not processed.get('has_errors') and not processed.get('has_warnings'):
        return ''  # –í—Å–µ —Ö–æ—Ä–æ—à–æ, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert
    
    alert_id = alert_id or 'math-alert'
    errors = processed.get('errors', [])
    warnings = processed.get('warnings', [])
    
    if errors:
        alert_class = 'alert-danger'
        icon = 'üö®'
        title = '–û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö'
        items = errors
    elif warnings:
        alert_class = 'alert-warning'
        icon = '‚ö†Ô∏è'
        title = '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö'
        items = warnings
    else:
        return ''
    
    items_html = ''.join([f'<li>{escape(item)}</li>' for item in items])
    
    return mark_safe(f'''
    <div class="alert {alert_class} alert-dismissible fade show" role="alert" id="{alert_id}">
        <h6>{icon} {title}</h6>
        <ul class="mb-0">
            {items_html}
        </ul>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
    </div>
    ''')

```

// FILE: tests.py
```
from django.test import TestCase

# Create your tests here.

```

// FILE: urls.py
```
from django.urls import path
from . import views

app_name = 'latex_generator'

urlpatterns = [
    # –í—Ä–µ–º–µ–Ω–Ω–æ —É–±–∏—Ä–∞–µ–º URL'—ã
    # path('generate/', views.GenerateView.as_view(), name='generate'),
    # path('status/', views.StatusView.as_view(), name='status'),
]

```

// FILE: utils/__init__.py
```
"""–≠–∫—Å–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç —Å –Ω–æ–≤—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏"""

# –ù–û–í–´–ï –ò–ú–ü–û–†–¢–´ –∏–∑ document_generator
from document_generator.utils.file_utils import sanitize_filename
from document_generator.utils.image_utils import prepare_images, render_task_with_images

# –°–¢–ê–†–´–ï –ò–ú–ü–û–†–¢–´ (LaTeX —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ)
from .latex_utils import sanitize_latex  # –û—Å—Ç–∞–µ—Ç—Å—è –≤ latex_generator
from .compilation import compile_latex_to_pdf, latex_compiler

__all__ = [
    'sanitize_latex',
    'sanitize_filename', 
    'prepare_images',
    'render_task_with_images',
    'compile_latex_to_pdf',
    'latex_compiler',
]

```

// FILE: utils/compilation.py
```
"""–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è LaTeX —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""

import subprocess
import tempfile
import shutil
import os
import re
import logging
from pathlib import Path
from typing import Dict, List, Optional, Tuple
from django.conf import settings

logger = logging.getLogger(__name__)

class LaTeXCompilationError(Exception):
    """–û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ LaTeX"""
    def __init__(self, message, error_details=None, latex_log=None):
        super().__init__(message)
        self.error_details = error_details or []
        self.latex_log = latex_log

class LaTeXCompiler:
    """–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä LaTeX —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""
    
    def __init__(self):
        self.latex_command = self._detect_latex_command()
        self.timeout = getattr(settings, 'LATEX_COMPILATION_TIMEOUT', 300)  # 5 –º–∏–Ω—É—Ç
        self.max_file_size = getattr(settings, 'LATEX_MAX_FILE_SIZE', 50 * 1024 * 1024)  # 50MB
    
    def _detect_latex_command(self) -> Optional[str]:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—É—é –∫–æ–º–∞–Ω–¥—É LaTeX"""
        commands_to_try = ['pdflatex', 'xelatex', 'lualatex']
        
        for cmd in commands_to_try:
            try:
                result = subprocess.run(
                    [cmd, '--version'], 
                    capture_output=True, 
                    timeout=10,
                    check=False
                )
                if result.returncode == 0:
                    logger.info(f"–ù–∞–π–¥–µ–Ω–∞ LaTeX –∫–æ–º–∞–Ω–¥–∞: {cmd}")
                    return cmd
            except (subprocess.TimeoutExpired, FileNotFoundError):
                continue
        
        logger.warning("LaTeX –∫–æ–º–∞–Ω–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ")
        return None
    
    def is_available(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å LaTeX"""
        return self.latex_command is not None
    
    def _safe_decode_bytes(self, byte_content: bytes) -> str:
        """–ù–û–í–û–ï: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–π—Ç–æ–≤ –≤ —Å—Ç—Ä–æ–∫—É"""
        if not byte_content:
            return ""
        
        encodings_to_try = ['utf-8', 'latin1', 'cp1251', 'cp866', 'iso-8859-1']
        
        for encoding in encodings_to_try:
            try:
                return byte_content.decode(encoding)
            except UnicodeDecodeError:
                continue
        
        # –ï—Å–ª–∏ –≤—Å–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –¥–µ–∫–æ–¥–∏—Ä—É–µ–º —Å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫
        return byte_content.decode('utf-8', errors='ignore')
    
    def _safe_read_log(self, log_file_path: Path) -> str:
        """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –ª–æ–≥ —Ñ–∞–π–ª–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∞–º–∏"""
        if not log_file_path.exists():
            return ""
        
        # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
        encodings_to_try = ['utf-8', 'latin1', 'cp1251', 'cp866', 'iso-8859-1']
        
        for encoding in encodings_to_try:
            try:
                with open(log_file_path, 'r', encoding=encoding, errors='ignore') as f:
                    content = f.read()
                logger.debug(f"–£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω –ª–æ–≥ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π: {encoding}")
                return content
            except Exception as e:
                logger.debug(f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ª–æ–≥ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π {encoding}: {e}")
                continue
        
        # –ï—Å–ª–∏ –≤—Å–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, —á–∏—Ç–∞–µ–º –∫–∞–∫ binary –∏ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º —Å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫
        try:
            with open(log_file_path, 'rb') as f:
                content = f.read().decode('utf-8', errors='ignore')
            logger.warning("–õ–æ–≥ –ø—Ä–æ—á–∏—Ç–∞–Ω –≤ —Ä–µ–∂–∏–º–µ binary —Å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫")
            return content
        except Exception as e:
            logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ª–æ–≥ —Ñ–∞–π–ª: {e}")
            return f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ª–æ–≥ —Ñ–∞–π–ª–∞: {e}"
    
    def parse_latex_log(self, log_content: str) -> Dict[str, any]:
        """–ü–∞—Ä—Å–∏—Ç –ª–æ–≥ LaTeX –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –æ—à–∏–±–∫–∏"""
        errors = []
        warnings = []
        
        if not log_content:
            return {
                'errors': [],
                'warnings': [],
                'has_errors': False,
                'has_warnings': False,
                'total_issues': 0
            }
        
        # –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
        error_patterns = [
            r'! (.+)',  # –û—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ LaTeX
            r'.*Error: (.+)',  # –û—à–∏–±–∫–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º Error
            r'.*Fatal error (.+)',  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
        ]
        
        warning_patterns = [
            r'Warning: (.+)',  # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            r'LaTeX Warning: (.+)',  # LaTeX –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            r'Package .+ Warning: (.+)',  # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤
        ]
        
        lines = log_content.split('\n')
        
        for i, line in enumerate(lines):
            line = line.strip()
            
            # –ò—â–µ–º –æ—à–∏–±–∫–∏
            for pattern in error_patterns:
                try:
                    match = re.search(pattern, line)
                    if match:
                        error_context = self._get_error_context(lines, i)
                        errors.append({
                            'message': match.group(1).strip(),
                            'line_number': i + 1,
                            'context': error_context,
                            'severity': 'error'
                        })
                except Exception as e:
                    logger.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å—Ç—Ä–æ–∫–∏ {i}: {e}")
            
            # –ò—â–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            for pattern in warning_patterns:
                try:
                    match = re.search(pattern, line)
                    if match:
                        warnings.append({
                            'message': match.group(1).strip(),
                            'line_number': i + 1,
                            'severity': 'warning'
                        })
                except Exception as e:
                    logger.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ {i}: {e}")
        
        return {
            'errors': errors,
            'warnings': warnings,
            'has_errors': len(errors) > 0,
            'has_warnings': len(warnings) > 0,
            'total_issues': len(errors) + len(warnings)
        }
    
    def _get_error_context(self, lines: List[str], error_line: int, context_size: int = 2) -> List[str]:
        """–ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–æ–∫—Ä—É–≥ —Å—Ç—Ä–æ–∫–∏ —Å –æ—à–∏–±–∫–æ–π"""
        start = max(0, error_line - context_size)
        end = min(len(lines), error_line + context_size + 1)
        
        context = []
        for i in range(start, end):
            prefix = '>>> ' if i == error_line else '    '
            context.append(f"{prefix}{lines[i].strip()}")
        
        return context
    
    def compile_latex_safe(self, latex_file: Path, output_dir: Path, 
                          max_attempts: int = 3) -> Dict[str, any]:
        """–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è LaTeX —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""
        
        if not self.is_available():
            return {
                'success': False,
                'error_type': 'system_error',
                'message': 'LaTeX –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ',
                'pdf_path': None,
                'suggestions': [
                    '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ LaTeX: sudo apt-get install texlive-full (Ubuntu)',
                    '–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTML –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤'
                ]
            }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
        try:
            if latex_file.stat().st_size > self.max_file_size:
                return {
                    'success': False,
                    'error_type': 'file_too_large',
                    'message': f'–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: {latex_file.stat().st_size / 1024 / 1024:.1f}MB',
                    'pdf_path': None
                }
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞: {e}")
        
        # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
        with tempfile.TemporaryDirectory() as temp_dir:
            temp_dir_path = Path(temp_dir)
            
            try:
                # –ö–æ–ø–∏—Ä—É–µ–º LaTeX —Ñ–∞–π–ª –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
                temp_latex_file = temp_dir_path / latex_file.name
                shutil.copy2(latex_file, temp_latex_file)
                
                # –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                try:
                    for image_file in output_dir.glob('*.png'):
                        shutil.copy2(image_file, temp_dir_path)
                    for image_file in output_dir.glob('*.jpg'):
                        shutil.copy2(image_file, temp_dir_path)
                    for image_file in output_dir.glob('*.jpeg'):
                        shutil.copy2(image_file, temp_dir_path)
                except Exception as e:
                    logger.warning(f"–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: {e}")
                
                # –ü—ã—Ç–∞–µ–º—Å—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å
                for attempt in range(max_attempts):
                    try:
                        logger.info(f"LaTeX –∫–æ–º–ø–∏–ª—è—Ü–∏—è, –ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}/{max_attempts}")
                        
                        # –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±–∏—Ä–∞–µ–º text=True –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
                        result = subprocess.run(
                            [
                                self.latex_command,
                                '-interaction=nonstopmode',  # –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –Ω–∞ –æ—à–∏–±–∫–∞—Ö
                                '-output-directory', str(temp_dir_path),
                                '-file-line-error',  # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –≤ –æ—à–∏–±–∫–∞—Ö
                                str(temp_latex_file)
                            ],
                            cwd=temp_dir_path,
                            capture_output=True,
                            # –£–ë–†–ê–ù–û: text=True  <- –≠—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É –∫–æ–¥–∏—Ä–æ–≤–∫–∏
                            timeout=self.timeout
                        )
                        
                        # –ò–°–ü–†–ê–í–õ–ï–ù–û: –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º –≤—ã–≤–æ–¥ subprocess
                        stdout_content = self._safe_decode_bytes(result.stdout)
                        stderr_content = self._safe_decode_bytes(result.stderr)
                        
                        # –ß–∏—Ç–∞–µ–º –ª–æ–≥ —Ñ–∞–π–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ
                        log_file = temp_dir_path / f"{temp_latex_file.stem}.log"
                        log_content = self._safe_read_log(log_file)
                        
                        # –ü–∞—Ä—Å–∏–º –ª–æ–≥
                        log_analysis = self.parse_latex_log(log_content)
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
                        pdf_file = temp_dir_path / f"{temp_latex_file.stem}.pdf"
                        
                        if pdf_file.exists() and pdf_file.stat().st_size > 0:
                            # –£—Å–ø–µ—à–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è - –∫–æ–ø–∏—Ä—É–µ–º PDF –≤ output_dir
                            output_pdf = output_dir / f"{latex_file.stem}.pdf"
                            shutil.copy2(pdf_file, output_pdf)
                            
                            return {
                                'success': True,
                                'pdf_path': str(output_pdf),
                                'attempts': attempt + 1,
                                'warnings': log_analysis.get('warnings', []),
                                'has_warnings': log_analysis.get('has_warnings', False),
                                'latex_log': log_content[:5000] if log_content else None  # –ü–µ—Ä–≤—ã–µ 5KB –ª–æ–≥–∞
                            }
                        
                        else:
                            # –ù–µ—É–¥–∞—á–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è
                            if attempt == max_attempts - 1:  # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞
                                return {
                                    'success': False,
                                    'error_type': 'compilation_failed',
                                    'message': 'LaTeX –∫–æ–º–ø–∏–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–∞–º–∏',
                                    'errors': log_analysis.get('errors', []),
                                    'warnings': log_analysis.get('warnings', []),
                                    'latex_log': log_content,
                                    'subprocess_stdout': stdout_content,  # –î–û–ë–ê–í–õ–ï–ù–û: –≤—ã–≤–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å–∞
                                    'subprocess_stderr': stderr_content,  # –î–û–ë–ê–í–õ–ï–ù–û: –æ—à–∏–±–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
                                    'suggestions': self._get_error_suggestions(log_analysis.get('errors', [])),
                                    'pdf_path': None
                                }
                            else:
                                # –ù–µ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
                                logger.warning(f"–ü–æ–ø—ã—Ç–∫–∞ {attempt + 1} –Ω–µ—É–¥–∞—á–Ω–∞, –ø–æ–≤—Ç–æ—Ä—è–µ–º")
                                continue
                    
                    except subprocess.TimeoutExpired:
                        if attempt == max_attempts - 1:
                            return {
                                'success': False,
                                'error_type': 'timeout',
                                'message': f'–ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–µ–≤—ã—Å–∏–ª–∞ –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏: {self.timeout}s',
                                'pdf_path': None,
                                'suggestions': [
                                    '–£–ø—Ä–æ—Å—Ç–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π',
                                    '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö'
                                ]
                            }
                    
                    except Exception as e:
                        error_msg = f'–°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞: {str(e)}'
                        logger.error(f"–ü–æ–ø—ã—Ç–∫–∞ {attempt + 1} –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π: {e}")
                        
                        if attempt == max_attempts - 1:
                            return {
                                'success': False,
                                'error_type': 'system_error', 
                                'message': error_msg,
                                'pdf_path': None
                            }
                        else:
                            continue
                            
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏: {e}")
                return {
                    'success': False,
                    'error_type': 'preparation_error',
                    'message': f'–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏: {str(e)}',
                    'pdf_path': None
                }
    
    def _get_error_suggestions(self, errors: List[Dict]) -> List[str]:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –æ—à–∏–±–æ–∫"""
        suggestions = set()  # –ò—Å–ø–æ–ª—å–∑—É–µ–º set –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        for error in errors:
            message = error.get('message', '').lower()
            
            if 'undefined control sequence' in message:
                suggestions.add('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è LaTeX –∫–æ–º–∞–Ω–¥')
                suggestions.add('–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã')
            
            elif 'missing' in message and '$' in message:
                suggestions.add('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–Ω–æ—Å—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ $ –∏ $$')
                suggestions.add('–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ñ–æ—Ä–º—É–ª—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã—Ç—ã')
            
            elif 'file not found' in message:
                suggestions.add('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω—ã')
                suggestions.add('–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º —É–∫–∞–∑–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ')
            
            elif 'package' in message and 'not found' in message:
                suggestions.add('–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ LaTeX –ø–∞–∫–µ—Ç—ã')
                suggestions.add('–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤')
        
        # –û–±—â–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        if not suggestions:
            suggestions.update([
                '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å LaTeX –∫–æ–º–∞–Ω–¥',
                '–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Å–∫–æ–±–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ',
                '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–ø—Ä–æ—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É–ª—ã –∏–ª–∏ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏'
            ])
        
        return list(suggestions)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
latex_compiler = LaTeXCompiler()

def compile_latex_to_pdf(latex_file: Path, output_dir: Path) -> Optional[str]:
    """–û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏"""
    result = latex_compiler.compile_latex_safe(latex_file, output_dir)
    
    if result['success']:
        return result['pdf_path']
    else:
        logger.error(f"LaTeX –∫–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–µ—É–¥–∞—á–Ω–∞: {result.get('message')}")
        return None

```

// FILE: utils/latex_specific.py
```
"""LaTeX —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã"""

from typing import Dict, Any
from document_generator.utils.formula_utils import formula_processor as base_processor

class LaTeXFormulaProcessor:
    """LaTeX —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —Ñ–æ—Ä–º—É–ª"""
    
    def __init__(self):
        self.base_processor = base_processor
    
    def render_for_latex_safe(self, text: str) -> Dict[str, Any]:
        """LaTeX —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"""
        if not text:
            return {'content': text, 'errors': [], 'warnings': []}
        
        # –ò–ó–ú–ï–ù–ï–ù–ê –õ–û–ì–ò–ö–ê: –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º —Ñ–æ—Ä–º—É–ª—ã –≤ –ò–°–•–û–î–ù–û–ú —Ç–µ–∫—Å—Ç–µ
        processed = self.process_text_safe(text)
        
        if not processed['has_math']:
            # –ï—Å–ª–∏ —Ñ–æ—Ä–º—É–ª –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º –æ—Ç –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –≤–Ω–µ —Ñ–æ—Ä–º—É–ª
            cleaned_text = self._sanitize_dangerous_latex_completely(text)
            return {'content': cleaned_text, 'errors': [], 'warnings': []}
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏
        safe_text = text
        all_errors = []
        all_warnings = []
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É–ª—ã –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π (—Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ)
        # —á—Ç–æ–±—ã –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ —Å–±–∏–≤–∞–ª–∏—Å—å –ø—Ä–∏ –∑–∞–º–µ–Ω–µ
        formulas_by_position = sorted(processed['formulas'], key=lambda f: f['position'][0], reverse=True)
        
        for formula in formulas_by_position:
            if not formula['validation']['is_valid']:
                # –ò–°–ü–†–ê–í–õ–ï–ù–û: –ó–∞–º–µ–Ω—è–µ–º –í–°–Æ —Ñ–æ—Ä–º—É–ª—É (–≤–∫–ª—é—á–∞—è $ –∏–ª–∏ $$) –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç
                errors = formula['validation']['errors']
                
                if any('–æ–ø–∞—Å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞' in error.lower() for error in errors):
                    # –î–ª—è –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ - –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç –ë–ï–ó –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
                    safe_replacement = "\\textbf{[–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–ê–Ø –ö–û–ú–ê–ù–î–ê]}"
                else:
                    # –î–ª—è –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫
                    error_count = len(errors)
                    safe_replacement = f"\\textbf{{[–û–®–ò–ë–ö–ê: {error_count} –ø—Ä–æ–±–ª–µ–º]}}"
                
                # –ó–∞–º–µ–Ω—è–µ–º –í–°–Æ —Ñ–æ—Ä–º—É–ª—É –≤–∫–ª—é—á–∞—è $ –∏–ª–∏ $$
                safe_text = safe_text[:formula['position'][0]] + safe_replacement + safe_text[formula['position'][1]:]
                
                all_errors.extend(formula['validation']['errors'])
                all_warnings.extend(formula['validation']['warnings'])
                
            else:
                # –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ LaTeX —Ñ–æ—Ä–º–∞—Ç
                if formula['type'] == 'display':
                    latex_formula = f"\\[{formula['content']}\\]"
                else:
                    latex_formula = f"\\({formula['content']}\\)"
                
                # –ó–∞–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º—É–ª—É –Ω–∞ LaTeX –≤–µ—Ä—Å–∏—é
                safe_text = safe_text[:formula['position'][0]] + latex_formula + safe_text[formula['position'][1]:]
        
        # –û—á–∏—â–∞–µ–º –æ—Ç –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –í–ù–ï —Ñ–æ—Ä–º—É–ª (–∫–æ—Ç–æ—Ä—ã–µ –æ—Å—Ç–∞–ª–∏—Å—å)
        safe_text = self._sanitize_dangerous_latex_completely(safe_text)
        
        return {
            'content': safe_text,
            'errors': all_errors,
            'warnings': all_warnings
        }
    
    def __getattr__(self, name):
        """–ü—Ä–æ–∫—Å–∏—Ä—É–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫ –±–∞–∑–æ–≤–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—É"""
        return getattr(self.base_processor, name)

# –°–æ–∑–¥–∞–µ–º LaTeX —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
latex_formula_processor = LaTeXFormulaProcessor()

```

// FILE: utils/latex_utils.py
```
"""LaTeX —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""

import re

def sanitize_latex(text):
    """–≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã LaTeX"""
    if not text:
        return ''
    
    # –°–ª–æ–≤–∞—Ä—å –∑–∞–º–µ–Ω –¥–ª—è LaTeX
    replacements = {
        '\\': r'\textbackslash{}',
        '{': r'\{',
        '}': r'\}',
        '$': r'\$',
        '&': r'\&',
        '%': r'\%',
        '#': r'\#',
        '^': r'\textasciicircum{}',
        '_': r'\_',
        '~': r'\textasciitilde{}',
        '<': r'\textless{}',
        '>': r'\textgreater{}',
    }
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º –∑–∞–º–µ–Ω—ã
    result = text
    for char, replacement in replacements.items():
        result = result.replace(char, replacement)
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
    result = result.replace('\n', '\\\\ ')
    
    return result

def sanitize_filename(filename):
    """–û—á–∏—â–∞–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞ –æ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤"""
    # –£–±–∏—Ä–∞–µ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
    clean = re.sub(r'[<>:"/\\|?*]', '_', filename)
    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
    clean = re.sub(r'\s+', '_', clean)
    return clean

```

// FILE: views.py
```
from django.shortcuts import render
from django.views.generic import TemplateView

class GenerateView(TemplateView):
    """–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""
    template_name = 'latex_generator/generate.html'
    
    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['title'] = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è LaTeX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤'
        return context

class StatusView(TemplateView):
    """–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"""
    template_name = 'latex_generator/status.html'
    
    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['title'] = '–°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'
        return context

```

