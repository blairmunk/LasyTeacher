<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ work_name }}</title>
    
    <!-- CSS —Å—Ç–∏–ª–∏ -->
    {{ css_styles|safe }}
    
    <!-- MathJax –¥–ª—è —Ñ–æ—Ä–º—É–ª -->
    {{ js_scripts|safe }}
</head>
<body>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div class="document-header">
        <div class="document-title">{{ work_name }}</div>
        <div class="document-info">
            <p><strong>–í—Å–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:</strong> {{ total_variants }}</p>
            <p><strong>–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</strong> {{ timestamp }}</p>
            {% if with_answers %}
            <p><strong>–í–µ—Ä—Å–∏—è:</strong> —Å –æ—Ç–≤–µ—Ç–∞–º–∏</p>
            {% endif %}
        </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Ñ–æ—Ä–º—É–ª -->
    {% if has_formula_errors or has_formula_warnings %}
    <div class="formula-issues">
        {% if has_formula_errors %}
        <div class="formula-errors" style="background-color: #f8d7da; color: #721c24; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <strong>‚ö†Ô∏è –û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö:</strong>
            <ul>
            {% for error in formula_errors %}
                <li>{{ error }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if has_formula_warnings %}
        <div class="formula-warnings" style="background-color: #fff3cd; color: #856404; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <strong>‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:</strong>
            <ul>
            {% for warning in formula_warnings %}
                <li>{{ warning }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–±–æ—Ç—ã -->
    {% for variant_data in variants %}
    <div class="variant-section">
        <div class="variant-title">
            –í–∞—Ä–∏–∞–Ω—Ç {{ variant_data.variant.number }}
        </div>

        <!-- –ó–∞–¥–∞–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ -->
        {% for task_data in variant_data.tasks %}
        <div class="task">
            <div class="task-number">
                –ó–∞–¥–∞–Ω–∏–µ {{ task_data.number }}
            </div>

            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–¥–∞–Ω–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏–ª–∏ –±–µ–∑ -->
            <div class="task-content">
                {% if task_data.images %}
                    <!-- –ó–∞–¥–∞–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º HTML –∫–æ–¥ –∏–∑ —É—Ç–∏–ª–∏—Ç -->
                    {{ task_data.html_content|safe }}
                {% else %}
                    <!-- –û–±—ã—á–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                    <div class="task-text">{{ task_data.text|safe }}</div>
                {% endif %}
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è -->
            {% if task_data.hint %}
            <div class="task-hint" style="margin-top: 10px; padding: 8px; background-color: #e7f3ff; border-left: 3px solid #007bff;">
                <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> {{ task_data.hint|safe }}
            </div>
            {% endif %}

            {% if task_data.instruction %}
            <div class="task-instruction" style="margin-top: 10px; padding: 8px; background-color: #f0f8ff; border-left: 3px solid #17a2b8;">
                <strong>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> {{ task_data.instruction|safe }}
            </div>
            {% endif %}

            <!-- –û—Ç–≤–µ—Ç—ã (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã) -->
            {% if with_answers and task_data.answer %}
            <div class="task-answer">
                <strong>–û—Ç–≤–µ—Ç:</strong> {{ task_data.answer|safe }}
            </div>
            {% endif %}

            {% if with_answers and task_data.short_solution %}
            <div class="task-solution" style="margin-top: 10px; padding: 10px; background-color: #d1ecf1; border-radius: 5px;">
                <strong>üîç –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ:</strong> {{ task_data.short_solution|safe }}
            </div>
            {% endif %}

            {% if with_answers and task_data.full_solution %}
            <div class="task-full-solution" style="margin-top: 10px; padding: 10px; background-color: #d4edda; border-radius: 5px;">
                <strong>üìù –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:</strong> {{ task_data.full_solution|safe }}
            </div>
            {% endif %}

            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ñ–æ—Ä–º—É–ª –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è -->
            {% if task_data.has_formula_errors %}
            <div class="task-formula-errors" style="margin-top: 10px; padding: 8px; background-color: #f8d7da; color: #721c24; border-radius: 3px; font-size: 12px;">
                <strong>‚ö†Ô∏è –û—à–∏–±–∫–∏ —Ñ–æ—Ä–º—É–ª –≤ –∑–∞–¥–∞–Ω–∏–∏:</strong>
                {% for error in task_data.formula_errors %}
                    <span class="error-item">{{ error }}</span>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endfor %}

    <!-- –§—É—Ç–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div class="document-footer" style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; text-align: center; color: #666; font-size: 12px;">
        <p>–î–æ–∫—É–º–µ–Ω—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω HTML Generator ‚Ä¢ {{ timestamp }}</p>
        <p>–§–æ—Ä–º—É–ª—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é <a href="https://www.mathjax.org/" target="_blank">MathJax</a></p>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ MathJax -->
    <script>
    // –î–æ–∂–∏–¥–∞–µ–º—Å—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ MathJax
    window.addEventListener('load', function() {
        console.log('üìä HTML –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
        console.log('üî¢ –ù–∞–π–¥–µ–Ω–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: {{ total_variants }}');
        console.log('üìù –í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π: {% for variant in variants %}{{ variant.total_tasks }}{% if not forloop.last %} + {% endif %}{% endfor %}');
        
        {% if has_formula_errors %}
        console.warn('‚ö†Ô∏è –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç {{ formula_errors|length }} –æ—à–∏–±–æ–∫ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö');
        {% endif %}
        
        // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ MathJax
        if (window.MathJax) {
            MathJax.startup.promise.then(() => {
                console.log('‚úÖ MathJax –≥–æ—Ç–æ–≤ –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é —Ñ–æ—Ä–º—É–ª');
            });
        }
    });
    </script>
</body>
</html>
